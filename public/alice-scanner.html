<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ALICE ORACLE - Pump.fun Scanner (Pro)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#000;color:#0ff;font-family:'Space Mono',monospace;min-height:100vh}
    .access-gate{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:10000}
    .gate-content{padding:60px 40px;border:3px solid #0ff;border-radius:15px;background:#000;box-shadow:0 0 50px rgba(0,255,255,.5);max-width:520px;width:92%;text-align:center}
    .gate-title{font-family:'Orbitron',sans-serif;font-size:56px;color:#0ff;text-shadow:0 0 30px rgba(0,255,255,.8);letter-spacing:.1em;margin-bottom:6px}
    .gate-input{width:100%;padding:18px 20px;font-size:18px;background:#111;border:2px solid #0ff;color:#0ff;text-align:center;border-radius:8px;letter-spacing:.2em;margin:16px 0}
    .gate-button{width:100%;padding:16px 20px;font-size:18px;background:#0ff;color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;letter-spacing:.15em}
    .gate-button:hover{background:#0aa;box-shadow:0 0 30px rgba(0,255,255,.8)}
    .scanner-container{display:none;padding:20px}
    .scanner-container.active{display:block}
    .header{text-align:center;padding:36px 0;border-bottom:2px solid #0ff;margin-bottom:24px}
    .main-title{font-family:'Orbitron',sans-serif;font-size:72px;color:#0ff;text-shadow:0 0 30px rgba(0,255,255,.8)}
    .status-bar{display:flex;justify-content:center;gap:18px;margin-top:10px;flex-wrap:wrap}
    .status-item{padding:10px 16px;border:1px solid #0ff;border-radius:6px;background:rgba(0,255,255,.1)}
    .controls{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin:26px 0}
    .scan-btn{padding:14px 32px;font-size:18px;background:linear-gradient(45deg,#0ff,#f0f);color:#000;border:none;border-radius:8px;font-weight:800;cursor:pointer}
    .filter-btn{padding:10px 18px;border:2px solid #f0f;background:transparent;color:#f0f;border-radius:6px;cursor:pointer}
    .filter-btn.active{background:#f0f;color:#000}
    .token-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:18px}
    .token-card{border:2px solid #0ff;border-radius:10px;padding:18px;background:rgba(0,20,40,.8);transition:.2s}
    .token-card:hover{transform:translateY(-2px);box-shadow:0 0 22px rgba(0,255,255,.35)}
    .token-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;border-bottom:1px solid rgba(0,255,255,.25);padding-bottom:10px}
    .token-name{font-size:20px;font-weight:800;color:#0ff}
    .token-symbol{color:#f0f;font-size:12px;background:rgba(255,0,255,.2);padding:2px 8px;border-radius:4px}
    .token-score{font-size:24px;font-weight:800;background:linear-gradient(45deg,#0ff,#f0f);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .token-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0}
    .stat{display:flex;justify-content:space-between;padding:6px;background:rgba(0,255,255,.05);border-radius:4px}
    .stat-label{color:#88a;font-size:11px}
    .stat-value{color:#0ff;font-weight:800}
    .layers{margin-top:8px}
    .layer{display:flex;align-items:center;gap:8px;margin:6px 0;font-size:12px}
    .layer .nm{width:130px;color:#88a}
    .bar{flex:1;height:6px;background:rgba(0,255,255,.12);border-radius:3px;overflow:hidden}
    .fill{height:100%;background:linear-gradient(90deg,#f0f,#0ff)}
    .val{width:80px;text-align:right;color:#0ff}
    .rec{margin-top:10px;text-align:center;padding:10px;border-radius:6px;font-weight:800}
    .rec.hot{background:rgba(255,100,0,.22);color:#ff7a00}
    .rec.acc{background:rgba(255,255,0,.22);color:#ffe400}
    .rec.risk{background:rgba(255,0,0,.22);color:#ff2b2b}
    .spike{display:inline-block;margin-left:8px;padding:2px 8px;border:1px solid #0ff;border-radius:999px;color:#0ff;font-size:11px}
    .token-links{display:flex;gap:10px;margin-top:12px}
    .token-link{flex:1;text-align:center;padding:8px;border:1px solid #0ff;border-radius:6px;color:#0ff;text-decoration:none;background:rgba(0,255,255,.08);font-size:12px}
    .no-data{text-align:center;padding:80px 10px;color:#888}
  </style>
</head>
<body>
  <div class="access-gate" id="accessGate">
    <div class="gate-content">
      <div class="gate-title">ALICE</div>
      <p style="color:#f0f;margin-bottom:14px">PUMP.FUN REAL-TIME SCANNER</p>
      <input class="gate-input" id="accessCode" placeholder="ENTER ACCESS CODE"/>
      <button class="gate-button" onclick="validateAccess()">ACCESS SCANNER</button>
      <div id="errorMsg" style="color:#f44;margin-top:10px"></div>
      <div style="margin-top:18px;padding:10px;border:1px solid #0ff;border-radius:6px">
        <p style="color:#ff0;font-size:12px;margin-bottom:6px">BETA TEST MODE</p>
        <p style="color:#0f0;font-size:11px">Try: ALICE2025</p>
      </div>
    </div>
  </div>

  <div class="scanner-container" id="scannerContainer">
    <div class="header">
      <div class="main-title">ALICE ORACLE</div>
      <p style="color:#f0f;font-size:18px;margin-top:6px">PUMP.FUN REAL-TIME SCANNER</p>
      <div class="status-bar">
        <div class="status-item">TOKENS: <span id="tokenCount" style="margin-left:6px">0</span></div>
        <div class="status-item">SOURCE: <span id="dataSource" style="margin-left:6px">LIVE</span></div>
        <div class="status-item">STATUS: <span id="scanStatus" style="margin-left:6px;color:#0f0">READY</span></div>
      </div>
    </div>

    <div class="controls">
      <button class="scan-btn" id="scanBtn" onclick="performScan()">üîÆ SCAN NOW</button>
      <button class="filter-btn active" onclick="setFilter('all', this)">ALL</button>
      <button class="filter-btn" onclick="setFilter('hot', this)">üî• HOT</button>
      <button class="filter-btn" onclick="setFilter('new', this)">üÜï NEW</button>
      <button class="filter-btn" onclick="setFilter('pumping', this)">üöÄ PUMPING</button>
      <button class="filter-btn" onclick="loadRecall()">HISTORY</button>
    </div>

    <div class="token-grid" id="tokenGrid">
      <div class="no-data">
        <h3>No Tokens Yet</h3>
        <p>Click ‚ÄúSCAN NOW‚Äù to fetch live tokens</p>
      </div>
    </div>
  </div>

<script>
  let accessGranted=false, currentTokens=[], currentFilter='all';
  const API_BASE = (window.__ALICE_CONFIG__ && window.__ALICE_CONFIG__.API_BASE) || '';
  const API_URL   = API_BASE ? (API_BASE.replace(/\/+$/,'') + '/api/scan')   : '/api/scan';
  const RECALL_URL= API_BASE ? (API_BASE.replace(/\/+$/,'') + '/api/recall') : '/api/recall';

  function validateAccess(){
    const code=document.getElementById('accessCode').value.trim();
    if(!code) return document.getElementById('errorMsg').textContent='Enter a code';
    const valid=['ALICE2025','DIAMOND_HANDS','ALPHA_ONLY','MOON_MISSION','INVESTOR_001','INVESTOR_002','INVESTOR_003','INVESTOR_004','BETA_TESTER_01','BETA_TESTER_02','BETA_TESTER_03'];
    if(valid.includes(code)){
      document.getElementById('accessGate').style.display='none';
      document.getElementById('scannerContainer').classList.add('active');
      accessGranted=true; setTimeout(performScan, 400);
    }else{
      document.getElementById('errorMsg').textContent='Invalid code';
    }
  }

  async function performScan(){
    if(!accessGranted) return;
    const btn=document.getElementById('scanBtn'), grid=document.getElementById('tokenGrid'), status=document.getElementById('scanStatus');
    btn.disabled=true; btn.textContent='‚è≥ SCANNING...'; status.textContent='SCANNING'; status.style.color='#ff0';
    try{
      const useTest=false; // set true to force stub
      const res=await fetch(useTest?`${API_URL}?test=true`:API_URL);
      const j=await res.json();
      if(!j || !j.success) throw new Error(j?.message||'Scan failed');
      currentTokens=j.tokens||[];
      document.getElementById('tokenCount').textContent=currentTokens.length;
      displayTokens(currentTokens);
      status.textContent='COMPLETE'; status.style.color='#0f0';
    }catch(e){
      grid.innerHTML=`<div class="no-data"><h3 style="color:#f44">Scan Failed</h3><p>${e.message}</p></div>`;
      status.textContent='ERROR'; status.style.color='#f00';
    }finally{
      btn.disabled=false; btn.textContent='üîÆ SCAN NOW';
    }
  }

  async function loadRecall(limit=500){
    if(!accessGranted) return;
    const status=document.getElementById('scanStatus'); const grid=document.getElementById('tokenGrid');
    status.textContent='LOADING HISTORY'; status.style.color='#ff0'; grid.innerHTML='';
    try{
      const res=await fetch(`${RECALL_URL}?limit=${limit}`); const j=await res.json();
      if(!j || !j.success) throw new Error(j?.message||'Recall failed');
      currentTokens=j.tokens||[]; document.getElementById('tokenCount').textContent=currentTokens.length;
      displayTokens(currentTokens); status.textContent='HISTORY'; status.style.color='#0f0';
    }catch(e){
      grid.innerHTML=`<div class="no-data"><h3 style="color:#f44">History Failed</h3><p>${e.message}</p></div>`;
      status.textContent='ERROR'; status.style.color='#f00';
    }
  }

  function setFilter(f,btn){
    currentFilter=f;
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active'); displayTokens(currentTokens);
  }

  function displayTokens(tokens){
    const grid=document.getElementById('tokenGrid');
    if(!tokens || !tokens.length){ grid.innerHTML='<div class="no-data"><h3>No results</h3></div>'; return; }

    let list=tokens.slice();
    if(currentFilter==='hot') list=list.filter(t=> (t.analysis?.recommendation||'').includes('HOT') || t.spiking);
    if(currentFilter==='new') list=list.filter(t=> (t.age_minutes||999)<30);
    if(currentFilter==='pumping') list=list.filter(t=> (t.pump_percent||0) > 8);

    grid.innerHTML = list.map(t=> cardHTML(t)).join('');
  }

  function cardHTML(t){
    const rec = (t.analysis?.recommendation||'üëÄ WATCH');
    const recClass = /HOT/.test(rec)?'hot':/ACCUMULATE/.test(rec)?'acc':/RISKY/.test(rec)?'risk':'';
    const layers = (t.analysis?.layers||[]).slice(0,10).map(L=>`
      <div class="layer">
        <div class="nm">${L.name}</div>
        <div class="bar"><div class="fill" style="width:${Math.max(0,Math.min(100, L.score||0))}%"></div></div>
        <div class="val">${L.value ?? ''}</div>
      </div>
    `).join('');

    const fdvDisp = t.dex?.fdv ?? t.fdv;
    const liqDisp = t.dex?.liquidityUsd ?? t.liquidity;
    const volDisp = t.dex?.volume24h ?? t.volume_24h;

    return `
    <div class="token-card">
      <div class="token-header">
        <div>
          <div class="token-name">${escapeHtml(t.name||'‚Äî')}</div>
          <span class="token-symbol">${escapeHtml((t.symbol||'').toUpperCase())}</span>
          ${t.spiking?'<span class="spike">SPIKING</span>':''}
        </div>
        <div class="token-score">${t.score ?? 0}</div>
      </div>

      <div class="token-stats">
        <div class="stat"><span class="stat-label">FDV</span><span class="stat-value">${fdvDisp?`$${Number(fdvDisp).toLocaleString()}`:'‚Äî'}</span></div>
        <div class="stat"><span class="stat-label">AGE</span><span class="stat-value">${t.age_minutes ?? '‚Äî'}m</span></div>
        <div class="stat"><span class="stat-label">BONDING</span><span class="stat-value">${t.bonding_curve?.toFixed?.(1)||'‚Äî'}%</span></div>
        <div class="stat"><span class="stat-label">LIQUIDITY</span><span class="stat-value">${liqDisp?`$${Math.round(liqDisp).toLocaleString()}`:'‚Äî'}</span></div>
        <div class="stat"><span class="stat-label">VOLUME 24h</span><span class="stat-value">${volDisp?`$${Math.round(volDisp).toLocaleString()}`:'‚Äî'}</span></div>
        <div class="stat"><span class="stat-label">HOLDERS</span><span class="stat-value">${t.holders ?? '‚Äî'}</span></div>
      </div>

      <div class="layers">${layers}</div>
      <div class="rec ${recClass}">${rec}</div>

      <div class="token-links">
        <a class="token-link" target="_blank" href="https://pump.fun/${t.contract_address}">PUMP.FUN</a>
        <a class="token-link" target="_blank" href="https://birdeye.so/token/${t.contract_address}?chain=solana">BIRDEYE</a>
        <a class="token-link" target="_blank" href="https://dexscreener.com/solana/${t.contract_address}">DEXSCREENER</a>
      </div>
    </div>`;
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  // Auto-refresh every 30s when unlocked and not scanning
  setInterval(()=>{ if(accessGranted){ performScan(); } }, 30000);

  document.getElementById('accessCode').addEventListener('keypress',e=>{ if(e.key==='Enter') validateAccess(); });
</script>
</body>
</html>

<!-- public/index.html — ALICE Billion UI (no deps, fast, neon, gated) -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ALICE — Small-Caps Oracle</title>
<meta name="color-scheme" content="dark">
<style>
:root{--bg:#05060e;--panel:#0b1122;--ink:#eaf4ff;--muted:#9fb1c7;--edge:#1b2744;--glow:#6be7ff;--rose:#ff7bd7;--lime:#9bff80;--warn:#ffd166;--danger:#ff5c7a}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:
  radial-gradient(1200px 600px at 20% -10%, rgba(107,231,255,.06), transparent 60%),
  radial-gradient(800px 400px at 120% 0, rgba(255,123,215,.06), transparent 50%),
  linear-gradient(180deg,#070815 0%,#040510 100%);
color:var(--ink);font:15px/1.55 Inter,system-ui,Segoe UI,Roboto}
.shell{max-width:1180px;margin:0 auto;padding:22px}
.top{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.logo{display:flex;gap:10px;align-items:center;font-weight:800;letter-spacing:1.2px;text-transform:uppercase;text-shadow:0 0 18px rgba(107,231,255,.35)}
.sigil{width:28px;height:28px;border-radius:8px;border:1px solid rgba(107,231,255,.35);box-shadow:0 0 35px rgba(107,231,255,.18) inset,0 0 25px rgba(255,123,215,.12) inset;background:
  radial-gradient(200px 120px at 30% 0%, rgba(255,123,215,.18), transparent 40%),
  radial-gradient(160px 120px at 70% 100%, rgba(107,231,255,.18), transparent 40%)}
.bar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;border:1px solid var(--edge);border-radius:16px;padding:10px 12px;background:linear-gradient(180deg, rgba(12,16,32,.7), rgba(6,9,20,.7))}
input,button,select{background:#0c1327;color:var(--ink);border:1px solid var(--edge);border-radius:12px;padding:10px 12px}
button{cursor:pointer;font-weight:700;letter-spacing:.3px}
button.primary{background:linear-gradient(180deg,#0f1b3e,#0a1328);border-color:#21406f}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:16px}
@media(max-width:980px){.grid{grid-template-columns:repeat(8,1fr)}}
@media(max-width:720px){.grid{grid-template-columns:repeat(4,1fr)}}
.card{grid-column:span 4;background:linear-gradient(180deg, rgba(16,24,48,.85), rgba(9,12,24,.85));border:1px solid var(--edge);border-radius:16px;padding:14px}
.row{display:flex;justify-content:space-between;align-items:center;gap:10px}.row+.row{margin-top:8px}
.pair{display:flex;gap:8px;align-items:center}.sym{font-weight:900;letter-spacing:.4px;font-size:13px;padding:4px 8px;border-radius:8px;background:#0d1630;border:1px solid #21355d}
.name{font-weight:700}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}.muted{color:var(--muted)}
.tag{font-size:11px;padding:3px 6px;border-radius:999px;border:1px solid #2a416e;background:#0b1224;margin-left:6px}
.good{color:var(--lime)}.warn{color:var(--warn)}.bad{color:var(--danger)}
.btnlink{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border-radius:10px;border:1px solid #21406f;background:#0c162f;text-decoration:none;color:#cfe8ff;font-weight:700}
.pill{font-size:12px;color:#d9ecff;border:1px solid var(--edge);border-radius:999px;padding:6px 10px;background:#0b1224}
.tiny{font-size:12px;color:var(--muted)}
.toast{position:fixed;right:18px;bottom:18px;background:#0b1224;border:1px solid #244;color:#dff5ff;padding:10px 12px;border-radius:12px;display:none}
</style>
</head>
<body>
  <div class="shell">
    <div class="top">
      <div class="logo"><div class="sigil"></div><span>ALICE • Oracle</span></div>
      <div class="controls">
        <select id="sort">
          <option value="master-desc">Score ⬇</option>
          <option value="age-asc">Newest</option>
          <option value="liq-desc">Liquidity ⬇</option>
          <option value="fdv-asc">FDV ⬇</option>
        </select>
        <button id="refresh">Refresh</button>
      </div>
    </div>

    <div class="bar">
      <div class="gate">
        <input id="code" placeholder="Access code" autocomplete="one-time-code"/>
        <button id="enter" class="primary">Enter</button>
        <span id="gateStatus" class="tiny">Locked</span>
      </div>
      <div id="cosmic" class="tiny">Cosmic: —</div>
    </div>

    <div class="bar" style="margin-top:12px">
      <div id="filters" class="pill mono">Filters: —</div>
      <div id="count" class="pill mono">Items: —</div>
      <div id="latency" class="pill mono">Latency: —</div>
    </div>

    <div id="grid" class="grid"></div>
  </div>
  <div id="toast" class="toast"></div>

<script>
const $=q=>document.querySelector(q); const grid=$('#grid'); const toast=$('#toast'); let authed=false; let cache=[];
const fmtUsd=n=>'$'+(Number(n||0)).toLocaleString(undefined,{maximumFractionDigits:0});
const fmtPct=n=>(n>0?'+':'')+(Number(n||0)).toFixed(2)+'%';
const ageTone=m=>m<=60?'good':(m<=240?'warn':'muted');
const sigTone=s=>s==='STRONG BUY'?'good':(s==='BUY'?'good':(s==='ACCUMULATE'?'warn':(s==='SELL'?'bad':'muted')));
function toastIt(m){ toast.textContent=m; toast.style.display='block'; setTimeout(()=>toast.style.display='none',1400); }

$('#enter').addEventListener('click', async ()=>{
  const code=$('#code').value.trim();
  const r=await fetch('/api/validate-code',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({code})});
  const j=await r.json(); authed=!!j.valid; $('#gateStatus').textContent=j.message||''; toastIt(j.message||'');
  if(authed) load();
});
$('#refresh').addEventListener('click', ()=> authed?load():toastIt('Unlock first'));
$('#sort').addEventListener('change', render);
$('#code').addEventListener('keydown', e=>{ if(e.key==='Enter') $('#enter').click(); });

async function load(){
  const t0=performance.now(); const r=await fetch('/api/analyze'); const j=await r.json(); const t1=performance.now();
  const moon=j?.cosmic?.moon, kp=j?.cosmic?.kp;
  $('#cosmic').textContent = `${moon?.emoji||''} ${moon?.phase||'—'} · Kp ${kp?.kp??'—'} (${kp?.level||'—'})`;
  const cfg=j?.config||{}; $('#filters').textContent=`FDV≤${fmtUsd(cfg.FDV_LIMIT)} · Liq≥${fmtUsd(cfg.MIN_LIQ_USD)} · Age≤${cfg.MAX_AGE_MIN}m · Limit ${cfg.LIMIT_RESULTS}`;
  $('#latency').textContent='Latency: '+(t1-t0).toFixed(0)+'ms';
  cache = Array.isArray(j?.tokens)? j.tokens.slice():[]; render();
}
function render(){
  const mode=$('#sort').value; const list=cache.slice();
  if(mode==='age-asc') list.sort((a,b)=>a.ageMinutes-b.ageMinutes);
  else if(mode==='liq-desc') list.sort((a,b)=>(b.liqUsd||0)-(a.liqUsd||0));
  else if(mode==='fdv-asc') list.sort((a,b)=>(a.fdv||0)-(b.fdv||0));
  else list.sort((a,b)=>(b.masterScore||0)-(a.masterScore||0));
  $('#count').textContent='Items: '+list.length;
  grid.innerHTML = list.map(t=>`
    <div class="card">
      <div class="row"><div class="pair">
        <span class="sym mono">${(t.symbol||'??').toUpperCase()}</span>
        <span class="name">${t.name||''}</span>
        ${(t.labels||[]).slice(0,3).map(l=>`<span class="tag">${l}</span>`).join('')}
      </div>
      <a class="btnlink mono" href="${t.pairUrl}" target="_blank" rel="noreferrer">Chart ↗</a></div>
      <div class="row mono muted">CA: ${t.tokenAddress||'—'}</div>
      <div class="row mono">FDV <b>${fmtUsd(t.fdv||0)}</b> · Liq <b>${fmtUsd(t.liqUsd||0)}</b> · <span class="${ageTone(t.ageMinutes||9999)}">Age ${t.ageMinutes||'?'}m</span></div>
      <div class="row mono">Δ5m <b class="${(t.change5m||0)>=0?'good':'bad'}">${fmtPct(t.change5m||0)}</b> · Δ1h <b class="${(t.change1h||0)>=0?'good':'bad'}">${fmtPct(t.change1h||0)}</b> · RSI <b>${t.rsi??'—'}</b></div>
      <div class="row mono">Score <b>${t.masterScore||0}</b> · <b class="${sigTone(t?.signal?.signal)}">${t?.signal?.signal||''}</b> · ${t.archetype||''}</div>
      <div class="row mono muted">Tx 5m B${t.txns5m?.buys||0}/S${t.txns5m?.sells||0} · 15m B${t.txns15m?.buys||0}/S${t.txns15m?.sells||0}</div>
    </div>`).join('');
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALICE ORACLE — Pump.fun Scanner (Merged)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap');

    /* RESET */
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#000;color:#0ff;font-family:'Space Mono',monospace;min-height:100vh;overflow-x:hidden}

    /* ───────────────── BACKGROUND FX (from your preferred style) ───────────── */
    .rotating-rectangles{position:fixed;inset:0;z-index:1;pointer-events:none}
    .rectangle{position:absolute;border:2px solid;animation:rotate 20s linear infinite}
    .rectangle:nth-child(1){width:300px;height:300px;top:10%;left:10%;border-color:#0ff;animation-duration:25s;opacity:.3}
    .rectangle:nth-child(2){width:400px;height:250px;top:50%;right:15%;border-color:#f0f;animation-duration:30s;animation-direction:reverse;opacity:.3}
    .rectangle:nth-child(3){width:350px;height:350px;bottom:10%;left:20%;border-color:#ff0;animation-duration:35s;opacity:.2}
    .rectangle:nth-child(4){width:280px;height:280px;top:30%;right:30%;border-color:#0f0;animation-duration:28s;animation-direction:reverse;opacity:.25}
    @keyframes rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    .grid-floor{position:fixed;left:0;bottom:0;width:100%;height:60vh;z-index:1;pointer-events:none;
      background:repeating-linear-gradient(0deg,rgba(255,0,110,.5) 0px,rgba(255,0,110,.5) 2px,transparent 2px,transparent 50px),
                 repeating-linear-gradient(90deg,rgba(0,255,255,.3) 0px,rgba(0,255,255,.3) 2px,transparent 2px,transparent 50px);
      transform:perspective(600px) rotateX(60deg);transform-origin:bottom center;animation:grid-move 25s linear infinite}
    @keyframes grid-move{0%{background-position:0 0,0 0}100%{background-position:0 50px,0 0}}

    .scanline{position:fixed;inset:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.08),rgba(0,0,0,.08) 1px,transparent 1px,transparent 2px);z-index:9999;pointer-events:none}

    /* ───────────────── ACCESS GATE (from functional version) ──────────────── */
    .access-gate{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:10000}
    .gate-content{padding:60px 40px;border:3px solid #0ff;border-radius:15px;background:#000;box-shadow:0 0 50px rgba(0,255,255,.5);max-width:520px;width:92%;text-align:center}
    .gate-title{font-family:'Orbitron',sans-serif;font-size:56px;color:#0ff;text-shadow:0 0 30px rgba(0,255,255,.8);letter-spacing:.1em;margin-bottom:6px}
    .gate-input{width:100%;padding:18px 20px;font-size:18px;background:#111;border:2px solid #0ff;color:#0ff;text-align:center;border-radius:8px;letter-spacing:.2em;margin:16px 0}
    .gate-button{width:100%;padding:16px 20px;font-size:18px;background:#0ff;color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;letter-spacing:.15em}
    .gate-button:hover{background:#0aa;box-shadow:0 0 30px rgba(0,255,255,.8)}

    /* ───────────────── MAIN CONTAINER (kept from preferred style) ─────────── */
    .scanner-container{padding:20px;position:relative;z-index:100;min-height:100vh;display:none}
    .scanner-container.active{display:block}
    .header{text-align:center;padding:50px 20px 40px;border-bottom:2px solid #0ff;margin-bottom:40px;background:rgba(0,20,40,.8);border-radius:10px}

    .glitch{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(48px,10vw,72px);color:#0ff;text-transform:uppercase;position:relative;letter-spacing:.05em;margin-bottom:15px;
      text-shadow:0 0 10px rgba(0,255,255,.8),0 0 20px rgba(0,255,255,.6),0 0 30px rgba(0,255,255,.4);animation:glitch-skew 3s ease-in-out infinite}
    .glitch::before,.glitch::after{content:attr(data-text);position:absolute;inset:0}
    .glitch::before{left:2px;text-shadow:-2px 0 #f0f;clip:rect(44px,450px,56px,0);animation:glitch-anim 5s infinite linear alternate-reverse}
    .glitch::after{left:-2px;text-shadow:-2px 0 #ff0;clip:rect(44px,450px,56px,0);animation:glitch-anim2 4s infinite linear alternate-reverse}
    @keyframes glitch-anim{0%{clip:rect(31px,9999px,94px,0)}20%{clip:rect(50px,9999px,20px,0)}40%{clip:rect(25px,9999px,87px,0)}60%{clip:rect(40px,9999px,61px,0)}80%{clip:rect(5px,9999px,102px,0)}100%{clip:rect(68px,9999px,41px,0)}}
    @keyframes glitch-anim2{0%{clip:rect(65px,9999px,99px,0)}20%{clip:rect(75px,9999px,30px,0)}40%{clip:rect(28px,9999px,72px,0)}60%{clip:rect(80px,9999px,25px,0)}80%{clip:rect(33px,9999px,70px,0)}100%{clip:rect(85px,9999px,28px,0)}}
    @keyframes glitch-skew{0%{transform:skew(0)}2%{transform:skew(-1.5deg)}4%{transform:skew(1.5deg)}100%{transform:skew(0)}}

    .status-bar{display:flex;justify-content:center;gap:30px;margin-top:25px;flex-wrap:wrap}
    .status-item{padding:12px 24px;border:2px solid #0ff;border-radius:8px;background:rgba(0,255,255,.1);transition:.3s;box-shadow:0 0 15px rgba(0,255,255,.2)}

    /* Controls */
    .controls{display:flex;gap:20px;margin:30px 0;flex-wrap:wrap;justify-content:center;padding:25px;background:rgba(0,20,40,.7);border:2px solid rgba(0,255,255,.3);border-radius:10px;box-shadow:0 5px 30px rgba(0,0,0,.5)}
    .scan-btn{padding:20px 60px;font-size:22px;background:linear-gradient(135deg,#0ff,#f0f);color:#000;border:none;border-radius:10px;cursor:pointer;font-weight:900;transition:.3s;text-transform:uppercase;font-family:'Orbitron',sans-serif;letter-spacing:.1em;box-shadow:0 6px 25px rgba(0,255,255,.5);position:relative;overflow:hidden}
    .scan-btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:rgba(255,255,255,.3);border-radius:50%;transform:translate(-50%,-50%);transition:width .6s,height .6s}
    .scan-btn:hover::before{width:300px;height:300px}
    .scan-btn:hover{transform:translateY(-3px);box-shadow:0 10px 35px rgba(0,255,255,.7)}
    .filter-btn{padding:14px 28px;background:transparent;border:2px solid #f0f;color:#f0f;border-radius:8px;cursor:pointer;transition:.3s;font-weight:700;text-transform:uppercase;font-size:14px;letter-spacing:.05em;box-shadow:0 0 10px rgba(255,0,255,.2)}
    .filter-btn.active{background:#f0f;color:#000;box-shadow:0 0 25px rgba(255,0,255,.8)}

    /* Grid + Cards (from preferred style) */
    .token-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:25px;margin-top:30px}
    .token-card{border:2px solid #0ff;border-radius:12px;padding:28px;background:rgba(0,20,40,.95);transition:.4s;animation:slideIn .6s ease;position:relative;overflow:hidden;box-shadow:0 5px 25px rgba(0,0,0,.6)}
    .token-card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,255,.15),transparent);transition:left .6s}
    .token-card:hover::before{left:100%}
    @keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .token-card:hover{transform:translateY(-8px);box-shadow:0 12px 45px rgba(0,255,255,.5);border-color:#f0f}
    .token-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;border-bottom:2px solid rgba(0,255,255,.3);padding-bottom:15px}
    .token-name{font-size:26px;font-weight:900;color:#0ff;font-family:'Orbitron',sans-serif;text-shadow:0 0 12px rgba(0,255,255,.6)}
    .token-symbol{color:#f0f;font-size:13px;background:rgba(255,0,255,.25);padding:5px 12px;border-radius:6px;margin-top:8px;display:inline-block;border:1px solid #f0f;font-weight:700;letter-spacing:.05em}
    .token-score{font-size:36px;font-weight:900;font-family:'Orbitron',sans-serif;background:linear-gradient(135deg,#0ff,#f0f,#ff0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 10px rgba(0,255,255,.5))}
    .token-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0}
    .stat{display:flex;justify-content:space-between;padding:12px 14px;background:rgba(0,255,255,.05);border-radius:6px;border:1px solid rgba(0,255,255,.2);transition:.3s}
    .stat:hover{background:rgba(0,255,255,.12);border-color:rgba(0,255,255,.5);transform:translateX(3px)}
    .stat-label{color:#888;font-size:11px;text-transform:uppercase;letter-spacing:.08em;font-weight:700}
    .stat-value{color:#0ff;font-weight:700;font-size:15px;text-shadow:0 0 8px rgba(0,255,255,.4)}
    .layers{margin-top:22px;padding-top:22px;border-top:2px solid rgba(0,255,255,.3)}
    .layer{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding:10px 0}
    .nm{color:#0ff;font-size:11px;text-transform:uppercase;font-weight:700;min-width:90px;letter-spacing:.08em;text-shadow:0 0 5px rgba(0,255,255,.3)}
    .bar{flex:1;margin:0 16px;height:10px;background:rgba(0,20,40,.8);border-radius:12px;overflow:hidden;position:relative;border:1px solid rgba(0,255,255,.3);box-shadow:inset 0 2px 5px rgba(0,0,0,.5)}
    .fill{height:100%;background:linear-gradient(90deg,#f0f 0%,#0ff 50%,#ff0 100%);transition:width 1s cubic-bezier(.4,0,.2,1);position:relative;border-radius:12px;box-shadow:0 0 12px rgba(0,255,255,.6)}
    .val{color:#ff0;font-weight:700;min-width:65px;text-align:right;font-size:14px;text-shadow:0 0 8px rgba(255,255,0,.6)}
    .rec{text-align:center;margin-top:22px;padding:16px;border-radius:10px;font-weight:900;font-size:18px;font-family:'Orbitron',sans-serif;text-transform:uppercase;letter-spacing:.12em;border:2px solid}
    .rec.hot{background:rgba(255,100,0,.25);color:#ff6400;border-color:#ff6400;box-shadow:0 0 25px rgba(255,100,0,.4)}
    .rec.acc{background:rgba(255,255,0,.25);color:#ffff00;border-color:#ffff00;box-shadow:0 0 25px rgba(255,255,0,.4)}
    .rec.risk{background:rgba(255,0,0,.25);color:#ff0000;border-color:#ff0000;box-shadow:0 0 25px rgba(255,0,0,.4)}
    .token-links{display:flex;gap:12px;margin-top:22px}
    .token-link{flex:1;padding:12px;text-align:center;background:rgba(0,255,255,.08);border:2px solid #0ff;border-radius:8px;color:#0ff;text-decoration:none;transition:.3s;font-size:12px;font-weight:700;text-transform:uppercase;box-shadow:0 0 12px rgba(0,255,255,.2);letter-spacing:.05em}
    .token-link:hover{background:rgba(0,255,255,.25);box-shadow:0 0 25px rgba(0,255,255,.6);transform:translateY(-3px);border-color:#f0f;color:#f0f}

    .no-data{text-align:center;padding:120px 20px;color:#888}
    .no-data h3{font-size:40px;color:#f0f;margin-bottom:20px;font-family:'Orbitron',sans-serif;text-shadow:0 0 25px rgba(255,0,255,.6);font-weight:900}

    @media (max-width:768px){.glitch{font-size:48px}.token-grid{grid-template-columns:1fr}.controls{flex-direction:column}.scan-btn,.filter-btn{width:100%}.status-bar{gap:15px}}
  </style>
</head>
<body>
  <!-- FX layers -->
  <div class="scanline"></div>
  <div class="grid-floor"></div>
  <div class="rotating-rectangles">
    <div class="rectangle"></div>
    <div class="rectangle"></div>
    <div class="rectangle"></div>
    <div class="rectangle"></div>
  </div>

  <!-- ACCESS GATE -->
  <div class="access-gate" id="accessGate">
    <div class="gate-content">
      <div class="gate-title">ALICE</div>
      <p style="color:#f0f;margin-bottom:14px">PUMP.FUN REAL-TIME SCANNER</p>
      <input class="gate-input" id="accessCode" placeholder="ENTER ACCESS CODE" />
      <button class="gate-button" onclick="validateAccess()">ACCESS SCANNER</button>
      <div id="errorMsg" style="color:#f44;margin-top:10px"></div>
      <div style="margin-top:18px;padding:10px;border:1px solid #0ff;border-radius:6px">
        <p style="color:#ff0;font-size:12px;margin-bottom:6px">BETA TEST MODE</p>
        <p style="color:#0f0;font-size:11px">Try: ALICE2025</p>
      </div>
    </div>
  </div>

  <!-- MAIN SCANNER -->
  <div class="scanner-container" id="scannerContainer">
    <div class="header">
      <h1 class="glitch" data-text="ALICE ORACLE">ALICE ORACLE</h1>
      <p style="color:#f0f;font-size:22px;font-family:'Orbitron',sans-serif;letter-spacing:.2em;margin-top:10px">PUMP.FUN REAL-TIME SCANNER</p>
      <div class="status-bar">
        <div class="status-item"><span style="color:#888;font-size:12px;text-transform:uppercase">TOKENS:</span> <span id="tokenCount" style="color:#0ff;font-weight:700;margin-left:10px;font-size:16px">0</span></div>
        <div class="status-item"><span style="color:#888;font-size:12px;text-transform:uppercase">SOURCE:</span> <span id="dataSource" style="color:#0ff;font-weight:700;margin-left:10px;font-size:14px">LIVE</span></div>
        <div class="status-item"><span style="color:#888;font-size:12px;text-transform:uppercase">STATUS:</span> <span id="scanStatus" style="color:#0f0;font-weight:700;margin-left:10px;font-size:14px">READY</span></div>
      </div>
    </div>

    <div class="controls">
      <button class="scan-btn" id="scanBtn" onclick="performScan()">SCAN NOW</button>
      <button class="filter-btn active" onclick="setFilter('all', this)">ALL</button>
      <button class="filter-btn" onclick="setFilter('hot', this)">HOT</button>
      <button class="filter-btn" onclick="setFilter('new', this)">NEW</button>
      <button class="filter-btn" onclick="setFilter('pumping', this)">PUMPING</button>
      <button class="filter-btn" onclick="loadRecall()">HISTORY</button>
    </div>

    <div class="token-grid" id="tokenGrid">
      <div class="no-data">
        <h3>No Tokens Scanned Yet</h3>
        <p style="font-size:18px;margin-top:18px;color:#0ff">Click "SCAN NOW" to discover the latest Pump.fun gems</p>
      </div>
    </div>
  </div>

  <script>
    // ───────── CONFIG (kept from functional version) ─────────
    let accessGranted=false, currentTokens=[], currentFilter='all';
    const API_BASE  = (window.__ALICE_CONFIG__ && window.__ALICE_CONFIG__.API_BASE) || '';
    const API_URL   = API_BASE ? (API_BASE.replace(/\/+$/,'') + '/api/scan')   : '/api/scan';
    const RECALL_URL= API_BASE ? (API_BASE.replace(/\/+$/,'') + '/api/recall') : '/api/recall';

    function validateAccess(){
      const code=document.getElementById('accessCode').value.trim();
      if(!code) return document.getElementById('errorMsg').textContent='Enter a code';
      const valid=['ALICE2025','DIAMOND_HANDS','ALPHA_ONLY','MOON_MISSION','INVESTOR_001','INVESTOR_002','INVESTOR_003','INVESTOR_004','BETA_TESTER_01','BETA_TESTER_02','BETA_TESTER_03'];
      if(valid.includes(code)){
        document.getElementById('accessGate').style.display='none';
        document.getElementById('scannerContainer').classList.add('active');
        accessGranted=true; setTimeout(performScan, 400);
      }else{
        document.getElementById('errorMsg').textContent='Invalid code';
      }
    }

    async function performScan(){
      if(!accessGranted) return;
      const btn=document.getElementById('scanBtn'), grid=document.getElementById('tokenGrid'), status=document.getElementById('scanStatus');
      btn.disabled=true; btn.textContent='⏳ SCANNING...'; status.textContent='SCANNING'; status.style.color='#ff0';
      try{
        const useTest=false; // flip true to force stub: `${API_URL}?test=true`
        const res=await fetch(useTest?`${API_URL}?test=true`:API_URL);
        const j=await res.json();
        if(!j || !j.success) throw new Error(j?.message||'Scan failed');
        currentTokens=j.tokens||[];
        document.getElementById('tokenCount').textContent=currentTokens.length;
        displayTokens(currentTokens);
        status.textContent='COMPLETE'; status.style.color='#0f0';
      }catch(e){
        grid.innerHTML=`<div class="no-data"><h3 style="color:#f44">Scan Failed</h3><p>${e.message}</p><p style="margin-top:10px;color:#888;font-size:14px">Make sure the server is running</p></div>`;
        status.textContent='ERROR'; status.style.color='#f00';
      }finally{ btn.disabled=false; btn.textContent='SCAN NOW'; }
    }

    async function loadRecall(limit=500){
      if(!accessGranted) return;
      const status=document.getElementById('scanStatus'); const grid=document.getElementById('tokenGrid');
      status.textContent='LOADING HISTORY'; status.style.color='#ff0'; grid.innerHTML='';
      try{
        const res=await fetch(`${RECALL_URL}?limit=${limit}`); const j=await res.json();
        if(!j || !j.success) throw new Error(j?.message||'Recall failed');
        currentTokens=j.tokens||[]; document.getElementById('tokenCount').textContent=currentTokens.length;
        displayTokens(currentTokens); status.textContent='HISTORY'; status.style.color='#0f0';
      }catch(e){
        grid.innerHTML=`<div class="no-data"><h3 style="color:#f44">History Failed</h3><p>${e.message}</p></div>`;
        status.textContent='ERROR'; status.style.color='#f00';
      }
    }

    function setFilter(f,btn){
      currentFilter=f;
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active'); displayTokens(currentTokens);
    }

    function displayTokens(tokens){
      const grid=document.getElementById('tokenGrid');
      if(!tokens || !tokens.length){ grid.innerHTML='<div class="no-data"><h3>No results</h3></div>'; return; }

      let list=tokens.slice();
      if(currentFilter==='hot') list=list.filter(t=> (t.analysis?.recommendation||'').includes('HOT') || t.spiking);
      if(currentFilter==='new') list=list.filter(t=> (t.age_minutes||999)<30);
      if(currentFilter==='pumping') list=list.filter(t=> (t.pump_percent||0) > 8);

      grid.innerHTML = list.map(t=> cardHTML(t)).join('');
    }

    // Card renderer using the PRETTY style
    function cardHTML(t){
      const rec=(t.analysis?.recommendation||'WATCH');
      const recClass=/HOT/.test(rec)?'hot':/ACCUMULATE/.test(rec)?'acc':/RISKY/.test(rec)?'risk':'acc';
      const layers=(t.analysis?.layers||[]).slice(0,10).map(L=>`
        <div class="layer">
          <span class="nm">${escapeHtml(L.name)}</span>
          <div class="bar"><div class="fill" style="width:${Math.max(0,Math.min(100,L.score||0))}%"></div></div>
          <span class="val">${L.value ?? ''}</span>
        </div>
      `).join('');

      const fdvDisp = t.dex?.fdv ?? t.fdv;
      const liqDisp = t.dex?.liquidityUsd ?? t.liquidity;
      const volDisp = t.dex?.volume24h ?? t.volume_24h;

      return `
      <div class="token-card">
        <div class="token-header">
          <div>
            <div class="token-name">${escapeHtml(t.name||'—')}</div>
            <span class="token-symbol">${escapeHtml((t.symbol||'').toUpperCase())}</span>
            ${t.spiking?'<span class="token-symbol" style="margin-left:8px;background:rgba(0,255,255,.25);border-color:#0ff;color:#0ff">SPIKING</span>':''}
          </div>
          <div class="token-score">${t.score ?? 0}</div>
        </div>

        <div class="token-stats">
          <div class="stat"><span class="stat-label">FDV</span><span class="stat-value">${fdvDisp?`$${Number(fdvDisp).toLocaleString()}`:'—'}</span></div>
          <div class="stat"><span class="stat-label">AGE</span><span class="stat-value">${t.age_minutes ?? '—'}m</span></div>
          <div class="stat"><span class="stat-label">BONDING</span><span class="stat-value">${t.bonding_curve?.toFixed?.(1)||'—'}%</span></div>
          <div class="stat"><span class="stat-label">LIQUIDITY</span><span class="stat-value">${liqDisp?`$${Math.round(liqDisp).toLocaleString()}`:'—'}</span></div>
          <div class="stat"><span class="stat-label">VOLUME 24h</span><span class="stat-value">${volDisp?`$${Math.round(volDisp).toLocaleString()}`:'—'}</span></div>
          <div class="stat"><span class="stat-label">HOLDERS</span><span class="stat-value">${t.holders ?? '—'}</span></div>
        </div>

        <div class="layers">${layers}</div>
        <div class="rec ${recClass}">${rec}</div>

        <div class="token-links">
          <a class="token-link" target="_blank" href="https://pump.fun/${t.contract_address}">PUMP.FUN</a>
          <a class="token-link" target="_blank" href="https://birdeye.so/token/${t.contract_address}?chain=solana">BIRDEYE</a>
          <a class="token-link" target="_blank" href="https://dexscreener.com/solana/${t.contract_address}">DEXSCREENER</a>
        </div>
      </div>`;
    }

    function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

    // Auto-refresh every 30s when unlocked
    setInterval(()=>{ if(accessGranted){ performScan(); } }, 30000);

    // Enter to submit code
    document.getElementById('accessCode').addEventListener('keypress',e=>{ if(e.key==='Enter') validateAccess(); });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALICE ORACLE — Pump.fun Scanner (Merged)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap');

    /* RESET */
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#000;color:#0ff;font-family:'Space Mono',monospace;min-height:100vh;overflow-x:hidden}

    /* ───────────────── BACKGROUND FX (from your preferred style) ───────────── */
    .rotating-rectangles{position:fixed;inset:0;z-index:1;pointer-events:none}
    .rectangle{position:absolute;border:2px solid;animation:rotate 20s linear infinite}
    .rectangle:nth-child(1){width:300px;height:300px;top:10%;left:10%;border-color:#0ff;animation-duration:25s;opacity:.3}
    .rectangle:nth-child(2){width:400px;height:250px;top:50%;right:15%;border-color:#f0f;animation-duration:30s;animation-direction:reverse;opacity:.3}
    .rectangle:nth-child(3){width:350px;height:350px;bottom:10%;left:20%;border-color:#ff0;animation-duration:35s;opacity:.2}
    .rectangle:nth-child(4){width:280px;height:280px;top:30%;right:30%;border-color:#0f0;animation-duration:28s;animation-direction:reverse;opacity:.25}
    @keyframes rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    .grid-floor{position:fixed;left:0;bottom:0;width:100%;height:60vh;z-index:1;pointer-events:none;
      background:repeating-linear-gradient(0deg,rgba(255,0,110,.5) 0px,rgba(255,0,110,.5) 2px,transparent 2px,transparent 50px),
                 repeating-linear-gradient(90deg,rgba(0,255,255,.3) 0px,rgba(0,255,255,.3) 2px,transparent 2px,transparent 50px);
      transform:perspective(600px) rotateX(60deg);transform-origin:bottom center;animation:grid-move 25s linear infinite}
    @keyframes grid-move{0%{background-position:0 0,0 0}100%{background-position:0 50px,0 0}}

    .scanline{position:fixed;inset:0;background:repeating-linear-gradient(0deg,rgba(0,0,0,.08),rgba(0,0,0,.08) 1px,transparent 1px,transparent 2px);z-index:9999;pointer-events:none}

    /* ───────────────── ACCESS GATE (from functional version) ──────────────── */
    .access-gate{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;z-index:10000}
    .gate-content{padding:60px 40px;border:3px solid #0ff;border-radius:15px;background:#000;box-shadow:0 0 50px rgba(0,255,255,.5);max-width:520px;width:92%;text-align:center}
    .gate-title{font-family:'Orbitron',sans-serif;font-size:56px;color:#0ff;text-shadow:0 0 30px rgba(0,255,255,.8);letter-spacing:.1em;margin-bottom:6px}
    .gate-input{width:100%;padding:18px 20px;font-size:18px;background:#111;border:2px solid #0ff;color:#0ff;text-align:center;border-radius:8px;letter-spacing:.2em;margin:16px 0}
    .gate-button{width:100%;padding:16px 20px;font-size:18px;background:#0ff;color:#000;border:none;border-radius:8px;font-weight:700;cursor:pointer;letter-spacing:.15em}
    .gate-button:hover{background:#0aa;box-shadow:0 0 30px rgba(0,255,255,.8)}

    /* ───────────────── MAIN CONTAINER (kept from preferred style) ─────────── */
    .scanner-container{padding:20px;position:relative;z-index:100;min-height:100vh;display:none}
    .scanner-container.active{display:block}
    .header{text-align:center;padding:50px 20px 40px;border-bottom:2px solid #0ff;margin-bottom:40px;background:rgba(0,20,40,.8);border-radius:10px}

    .glitch{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(48px,10vw,72px);color:#0ff;text-transform:uppercase;position:relative;letter-spacing:.05em;margin-bottom:15px;
      text-shadow:0 0 10px rgba(0,255,255,.8),0 0 20px rgba(0,255,255,.6),0 0 30px rgba(0,255,255,.4);animation:glitch-skew 3s ease-in-out infinite}
    .glitch::before,.glitch::after{content:attr(data-text);position:absolute;inset:0}
    .glitch::before{left:2px;text-shadow:-2px 0 #f0f;clip:rect(44px,450px,56px,0);animation:glitch-anim 5s infinite linear alternate-reverse}
    .glitch::after{left:-2px;text-shadow:-2px 0 #ff0;clip:rect(44px,450px,56px,0);animation:glitch-anim2 4s infinite linear alternate-reverse}
    @keyframes glitch-anim{0%{clip:rect(31px,9999px,94px,0)}20%{clip:rect(50px,9999px,20px,0)}40%{clip:rect(25px,9999px,87px,0)}60%{clip:rect(40px,9999px,61px,0)}80%{clip:rect(5px,9999px,102px,0)}100%{clip:rect(68px,9999px,41px,0)}}
    @keyframes glitch-anim2{0%{clip:rect(65px,9999px,99px,0)}20%{clip:rect(75px,9999px,30px,0)}40%{clip:rect(28px,9999px,72px,0)}60%{clip:rect(80px,9999px,25px,0)}80%{clip:rect(33px,9999px,70px,0)}100%{clip:rect(85px,9999px,28px,0)}}
    @keyframes glitch-skew{0%{transform:skew(0)}2%{transform:skew(-1.5deg)}4%{transform:skew(1.5deg)}100%{transform:skew(0)}}

    .status-bar{display:flex;justify-content:center;gap:30px;margin-top:25px;flex-wrap:wrap}
    .status-item{padding:12px 24px;border:2px solid #0ff;border-radius:8px;background:rgba(0,255,255,.1);transition:.3s;box-shadow:0 0 15px rgba(0,255,255,.2)}

    /* Controls */
    .controls{display:flex;gap:20px;margin:30px 0;flex-wrap:wrap;justify-content:center;padding:25px;background:rgba(0,20,40,.7);border:2px solid rgba(0,255,255,.3);border-radius:10px;box-shadow:0 5px 30px rgba(0,0,0,.5)}
    .scan-btn{padding:20px 60px;font-size:22px;background:linear-gradient(135deg,#0ff,#f0f);color:#000;border:none;border-radius:10px;cursor:pointer;font-weight:900;transition:.3s;text-transform:uppercase;font-family:'Orbitron',sans-serif;letter-spacing:.1em;box-shadow:0 6px 25px rgba(0,255,255,.5);position:relative;overflow:hidden}
    .scan-btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:rgba(255,255,255,.3);border-radius:50%;transform:translate(-50%,-50%);transition:width .6s,height .6s}
    .scan-btn:hover::before{width:300px;height:300px}
    .scan-btn:hover{transform:translateY(-3px);box-shadow:0 10px 35px rgba(0,255,255,.7)}
    .filter-btn{padding:14px 28px;background:transparent;border:2px solid #f0f;color:#f0f;border-radius:8px;cursor:pointer;transition:.3s;font-weight:700;text-transform:uppercase;font-size:14px;letter-spacing:.05em;box-shadow:0 0 10px rgba(255,0,255,.2)}
    .filter-btn.active{background:#f0f;color:#000;box-shadow:0 0 25px rgba(255,0,255,.8)}

    /* Grid + Cards (from preferred style) */
    .token-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:25px;margin-top:30px}
    .token-card{border:2px solid #0ff;border-radius:12px;padding:28px;background:rgba(0,20,40,.95);transition:.4s;animation:slideIn .6s ease;position:relative;overflow:hidden;box-shadow:0 5px 25px rgba(0,0,0,.6)}
    .token-card::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,255,.15),transparent);transition:left .6s}
    .token-card:hover::before{left:100%}
    @keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .token-card:hover{transform:translateY(-8px);box-shadow:0 12px 45px rgba(0,255,255,.5);border-color:#f0f}
    .token-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;border-bottom:2px solid rgba(0,255,255,.3);padding-bottom:15px}
    .token-name{font-size:26px;font-weight:900;color:#0ff;font-family:'Orbitron',sans-serif;text-shadow:0 0 12px rgba(0,255,255,.6)}
    .token-symbol{color:#f0f;font-size:13px;background:rgba(255,0,255,.25);padding:5px 12px;border-radius:6px;margin-top:8px;display:inline-block;border:1px solid #f0f;font-weight:700;letter-spacing:.05em}
    .token-score{font-size:36px;font-weight:900;font-family:'Orbitron',sans-serif;background:linear-gradient(135deg,#0ff,#f0f,#ff0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 10px rgba(0,255,255,.5))}
    .token-stats{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:20px 0}
    .stat{display:flex;justify-content:space-between;padding:12px 14px;background:rgba(0,255,255,.05);border-radius:6px;border:1px solid rgba(0,255,255,.2);transition:.3s}
    .stat:hover{background:rgba(0,255,255,.12);border-color:rgba(0,255,255,.5);transform:translateX(3px)}
    .stat-label{color:#888;font-size:11px;text-transform:uppercase;letter-spacing:.08em;font-weight:700}
    .stat-value{color:#0ff;font-weight:700;font-size:15px;text-shadow:0 0 8px rgba(0,255,255,.4)}
    .layers{margin-top:22px;padding-top:22px;border-top:2px solid rgba(0,255,255,.3)}
    .layer{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding:10px 0}
    .nm{color:#0ff;font-size:11px;text-transform:uppercase;font-weight:700;min-width:90px;letter-spacing:.08em;text-shadow:0 0 5px rgba(0,255,255,.3)}
    .bar{flex:1;margin:0 16px;height:10px;background:rgba(0,20,40,.8);border-radius:12px;overflow:hidden;position:relative;border:1px solid rgba(0,255,255,.3);box-shadow:inset 0 2px 5px rgba(0,0,0,.5)}
    .fill{height:100%;background:linear-gradient(90deg,#f0f 0%,#0ff 50%,#ff0 100%);transition:width 1s cubic-bezier(.4,0,.2,1);position:relative;border-radius:12px;box-shadow:0 0 12px rgba(0,255,255,.6)}
    .val{color:#ff0;font-weight:700;min-width:65px;text-align:right;font-size:14px;text-shadow:0 0 8px rgba(255,255,0,.6)}
    .rec{text-align:center;margin-top:22px;padding:16px;border-radius:10px;font-weight:900;font-size:18px;font-family:'Orbitron',sans-serif;text-transform:uppercase;letter-spacing:.12em;border:2px solid}
    .rec.hot{background:rgba(255,100,0,.25);color:#ff6400;border-color:#ff6400;box-shadow:0 0 25px rgba(255,100,0,.4)}
    .rec.acc{background:rgba(255,255,0,.25);color:#ffff00;border-color:#ffff00;box-shadow:0 0 25px rgba(255,255,0,.4)}
    .rec.risk{background:rgba(255,0,0,.25);color:#ff0000;border-color:#ff0000;box-shadow:0 0 25px rgba(255,0,0,.4)}
    .token-links{display:flex;gap:12px;margin-top:22px}
    .token-link{flex:1;padding:12px;text-align:center;background:rgba(0,255,255,.08);border:2px solid #0ff;border-radius:8px;color:#0ff;text-decoration:none;transition:.3s;font-size:12px;font-weight:700;text-transform:uppercase;box-shadow:0 0 12px rgba(0,255,255,.2);letter-spacing:.05em}
    .token-link:hover{background:rgba(0,255,255,.25);box-shadow:0 0 25px rgba(0,255,255,.6);transform:translateY(-3px);border-color:#f0f;color:#f0f}

    .no-data{text-align:center;padding:120px 20px;color:#888}
    .no-data h3{font-size:40px;color:#f0f;margin-bottom:20px;font-family:'Orbitron',sans-serif;text-shadow:0 0 25px rgba(255,0,255,.6);font-weight:900}

    @media (max-width:768px){.glitch{font-size:48px}.token-grid{grid-template-columns:1fr}.controls{flex-direction:column}.scan-btn,.filter-btn{width:100%}.status-bar{gap:15px}}
  </style>
</head>
<body>
  <!-- FX layers -->
  <div class="scanline"></div>
  <div class="grid-floor"></div>
  <div class="rotating-rectangles">
    <div class="rectangle"></div>
    <div class="rectangle"></div>
    <div class="rectangle"></div>
    <div class="rectangle"></div>
  </div>

  <!-- ACCESS GATE -->
  <div class="access-gate" id="accessGate">
    <div class="gate-content">
      <div class="gate-title">ALICE</div>
      <p style="color:#f0f;margin-bottom:14px">PUMP.FUN REAL-TIME SCANNER</p>
      <input class="gate-input" id="accessCode" placeholder="ENTER ACCESS CODE" />
      <button class="gate-button" onclick="validateAccess()">ACCESS SCANNER</button>
      <div id="errorMsg" style="color:#f44;margin-top:10px"></div>
      <div style="margin-top:18px;padding:10px;border:1px solid #0ff;border-radius:6px">
        <p style="color:#ff0;font-size:12px;margin-bottom:6px">BETA TEST MODE</p>
        <p style="color:#0f0;font-size:11px">Try: ALICE2025</p>
      </div>
    </div>
  </div>

  <!-- MAIN SCANNER -->
  <div class="scanner-container" id="scannerContainer">
    <div class="header">
      <h1 class="glitch" data-text="ALICE ORACLE">ALICE ORACLE</h1>
      <p style="color:#f0f;font-size:22px;font-family:'Orbitron',sans-serif;letter-spacing:.2em;margin-top:10px">PUMP.FUN REAL-TIME SCANNER</p>
      <div class="status-bar">
        <div class="status-item"><span style="color:#888;font-size:12px;text-transform:uppercase">TOKENS:</span> <span id="tokenCount" style="color:#0ff;font-weight:700;margin-left:10px;font-size:16px">0</span></div>
        <div class="status-item"><span style="color:#888;font-size:12px;text-transform:uppercase">SOURCE:</span> <span id="dataSource" style="color:#0ff;font-weight:700;margin-left:10px;font-size:14px">LIVE</span></div>
        <div class="status-item"><span style="color:#888;font-size:12px;text-transform:uppercase">STATUS:</span> <span id="scanStatus" style="color:#0f0;font-weight:700;margin-left:10px;font-size:14px">READY</span></div>
      </div>
    </div>

    <div class="controls">
      <button class="scan-btn" id="scanBtn" onclick="performScan()">SCAN NOW</button>
      <button class="filter-btn active" onclick="setFilter('all', this)">ALL</button>
      <button class="filter-btn" onclick="setFilter('hot', this)">HOT</button>
      <button class="filter-btn" onclick="setFilter('new', this)">NEW</button>
      <button class="filter-btn" onclick="setFilter('pumping', this)">PUMPING</button>
      <button class="filter-btn" onclick="loadRecall()">HISTORY</button>
    </div>

    <div class="token-grid" id="tokenGrid">
      <div class="no-data">
        <h3>No Tokens Scanned Yet</h3>
        <p style="font-size:18px;margin-top:18px;color:#0ff">Click "SCAN NOW" to discover the latest Pump.fun gems</p>
      </div>
    </div>
  </div>

  <script>
    // ───────── CONFIG (kept from functional version) ─────────
    let accessGranted=false, currentTokens=[], currentFilter='all';
    const API_BASE  = (window.__ALICE_CONFIG__ && window.__ALICE_CONFIG__.API_BASE) || '';
    const API_URL   = API_BASE ? (API_BASE.replace(/\/+$/,'') + '/api/scan')   : '/api/scan';
    const RECALL_URL= API_BASE ? (API_BASE.replace(/\/+$/,'') + '/api/recall') : '/api/recall';

    function validateAccess(){
      const code=document.getElementById('accessCode').value.trim();
      if(!code) return document.getElementById('errorMsg').textContent='Enter a code';
      const valid=['ALICE2025','DIAMOND_HANDS','ALPHA_ONLY','MOON_MISSION','INVESTOR_001','INVESTOR_002','INVESTOR_003','INVESTOR_004','BETA_TESTER_01','BETA_TESTER_02','BETA_TESTER_03'];
      if(valid.includes(code)){
        document.getElementById('accessGate').style.display='none';
        document.getElementById('scannerContainer').classList.add('active');
        accessGranted=true; setTimeout(performScan, 400);
      }else{
        document.getElementById('errorMsg').textContent='Invalid code';
      }
    }

    async function performScan(){
      if(!accessGranted) return;
      const btn=document.getElementById('scanBtn'), grid=document.getElementById('tokenGrid'), status=document.getElementById('scanStatus');
      btn.disabled=true; btn.textContent='⏳ SCANNING...'; status.textContent='SCANNING'; status.style.color='#ff0';
      try{
        const useTest=false; // flip true to force stub: `${API_URL}?test=true`
        const res=await fetch(useTest?`${API_URL}?test=true`:API_URL);
        const j=await res.json();
        if(!j || !j.success) throw new Error(j?.message||'Scan failed');
        currentTokens=j.tokens||[];
        document.getElementById('tokenCount').textContent=currentTokens.length;
        displayTokens(currentTokens);
        status.textContent='COMPLETE'; status.style.color='#0f0';
      }catch(e){
        grid.innerHTML=`<div class="no-data"><h3 style="color:#f44">Scan Failed</h3><p>${e.message}</p><p style="margin-top:10px;color:#888;font-size:14px">Make sure the server is running</p></div>`;
        status.textContent='ERROR'; status.style.color='#f00';
      }finally{ btn.disabled=false; btn.textContent='SCAN NOW'; }
    }

    async function loadRecall(limit=500){
      if(!accessGranted) return;
      const status=document.getElementById('scanStatus'); const grid=document.getElementById('tokenGrid');
      status.textContent='LOADING HISTORY'; status.style.color='#ff0'; grid.innerHTML='';
      try{
        const res=await fetch(`${RECALL_URL}?limit=${limit}`); const j=await res.json();
        if(!j || !j.success) throw new Error(j?.message||'Recall failed');
        currentTokens=j.tokens||[]; document.getElementById('tokenCount').textContent=currentTokens.length;
        displayTokens(currentTokens); status.textContent='HISTORY'; status.style.color='#0f0';
      }catch(e){
        grid.innerHTML=`<div class="no-data"><h3 style="color:#f44">History Failed</h3><p>${e.message}</p></div>`;
        status.textContent='ERROR'; status.style.color='#f00';
      }
    }

    function setFilter(f,btn){
      currentFilter=f;
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active'); displayTokens(currentTokens);
    }

    function displayTokens(tokens){
      const grid=document.getElementById('tokenGrid');
      if(!tokens || !tokens.length){ grid.innerHTML='<div class="no-data"><h3>No results</h3></div>'; return; }

      let list=tokens.slice();
      if(currentFilter==='hot') list=list.filter(t=> (t.analysis?.recommendation||'').includes('HOT') || t.spiking);
      if(currentFilter==='new') list=list.filter(t=> (t.age_minutes||999)<30);
      if(currentFilter==='pumping') list=list.filter(t=> (t.pump_percent||0) > 8);

      grid.innerHTML = list.map(t=> cardHTML(t)).join('');
    }

    // Card renderer using the PRETTY style
    function cardHTML(t){
      const rec=(t.analysis?.recommendation||'WATCH');
      const recClass=/HOT/.test(rec)?'hot':/ACCUMULATE/.test(rec)?'acc':/RISKY/.test(rec)?'risk':'acc';
      const layers=(t.analysis?.layers||[]).slice(0,10).map(L=>`
        <div class="layer">
          <span class="nm">${escapeHtml(L.name)}</span>
          <div class="bar"><div class="fill" style="width:${Math.max(0,Math.min(100,L.score||0))}%"></div></div>
          <span class="val">${L.value ?? ''}</span>
        </div>
      `).join('');

      const fdvDisp = t.dex?.fdv ?? t.fdv;
      const liqDisp = t.dex?.liquidityUsd ?? t.liquidity;
      const volDisp = t.dex?.volume24h ?? t.volume_24h;

      return `
      <div class="token-card">
        <div class="token-header">
          <div>
            <div class="token-name">${escapeHtml(t.name||'—')}</div>
            <span class="token-symbol">${escapeHtml((t.symbol||'').toUpperCase())}</span>
            ${t.spiking?'<span class="token-symbol" style="margin-left:8px;background:rgba(0,255,255,.25);border-color:#0ff;color:#0ff">SPIKING</span>':''}
          </div>
          <div class="token-score">${t.score ?? 0}</div>
        </div>

        <div class="token-stats">
          <div class="stat"><span class="stat-label">FDV</span><span class="stat-value">${fdvDisp?`$${Number(fdvDisp).toLocaleString()}`:'—'}</span></div>
          <div class="stat"><span class="stat-label">AGE</span><span class="stat-value">${t.age_minutes ?? '—'}m</span></div>
          <div class="stat"><span class="stat-label">BONDING</span><span class="stat-value">${t.bonding_curve?.toFixed?.(1)||'—'}%</span></div>
          <div class="stat"><span class="stat-label">LIQUIDITY</span><span class="stat-value">${liqDisp?`$${Math.round(liqDisp).toLocaleString()}`:'—'}</span></div>
          <div class="stat"><span class="stat-label">VOLUME 24h</span><span class="stat-value">${volDisp?`$${Math.round(volDisp).toLocaleString()}`:'—'}</span></div>
          <div class="stat"><span class="stat-label">HOLDERS</span><span class="stat-value">${t.holders ?? '—'}</span></div>
        </div>

        <div class="layers">${layers}</div>
        <div class="rec ${recClass}">${rec}</div>

        <div class="token-links">
          <a class="token-link" target="_blank" href="https://pump.fun/${t.contract_address}">PUMP.FUN</a>
          <a class="token-link" target="_blank" href="https://birdeye.so/token/${t.contract_address}?chain=solana">BIRDEYE</a>
          <a class="token-link" target="_blank" href="https://dexscreener.com/solana/${t.contract_address}">DEXSCREENER</a>
        </div>
      </div>`;
    }

    function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

    // Auto-refresh every 30s when unlocked
    setInterval(()=>{ if(accessGranted){ performScan(); } }, 30000);

    // Enter to submit code
    document.getElementById('accessCode').addEventListener('keypress',e=>{ if(e.key==='Enter') validateAccess(); });
  </script>
</body>
</html>
